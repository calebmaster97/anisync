<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>VortexAnime – Anime Browser</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* ============================================================
   PREMIUM GLASSMORPHISM VORTEXANIME THEME
   ============================================================ */
:root {
  --bg: #0d0f14;
  --card: rgba(255, 255, 255, 0.05);
  --glass: rgba(255, 255, 255, 0.06);
  --border: rgba(255, 255, 255, 0.15);
  --text: #f3f6fa;
  --muted: #9ca7b8;
  --accent: #7aa2ff;
  --accent2: #8bd8ff;
  --round: 14px;
  --blur: 18px;
  --shadow: 0 0 25px rgba(0, 0, 0, 0.4);
  --card-shadow: 0 8px 35px rgba(0, 0, 0, 0.45);
}

* { box-sizing: border-box; font-family: "Inter", Arial, sans-serif; }

body {
  margin: 0;
  background: radial-gradient(circle at top, #151922, #0d0f14);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

header {
  text-align: center;
  padding: 40px 10px;
  background: linear-gradient(to bottom, #131722aa, #0d0f1400);
  backdrop-filter: blur(10px);
}

header h1 {
  font-size: 3.5rem;
  margin: 0;
  font-weight: 800;
  background: linear-gradient(90deg, #7aa2ff, #8bd8ff);
  -webkit-background-clip: text;
  color: transparent;
  letter-spacing: -2px;
}

/* WELCOME MODAL */
.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  z-index: 3000; visibility: hidden; opacity: 0; transition: 0.4s ease;
}

.modal-content {
  background: #11141d; border: 1px solid var(--border);
  padding: 35px; border-radius: 20px; text-align: center;
  max-width: 420px; width: 90%; box-shadow: var(--shadow);
}

.modal-content h2 { color: var(--accent); margin: 0 0 15px 0; }
.modal-content p { color: var(--muted); line-height: 1.6; margin-bottom: 25px; }

/* CONTROLS */
.controls {
  display: flex; gap: 12px; padding: 18px; flex-wrap: wrap;
  justify-content: center; background: var(--glass);
  border: 1px solid var(--border); backdrop-filter: blur(var(--blur));
  border-radius: var(--round); margin: 0 auto 30px auto;
  width: clamp(260px, 95%, 1200px); box-shadow: var(--shadow);
}

.controls select, .controls input, .controls button {
  padding: 12px 16px; border-radius: var(--round);
  background: rgba(255, 255, 255, 0.07); border: 1px solid var(--border);
  color: var(--text); font-size: 0.95rem; transition: 0.2s ease;
}

.controls input { flex-grow: 2; min-width: 250px; }

button {
  cursor: pointer; font-weight: 600;
  background: linear-gradient(135deg, #7aa2ff55, #8bd8ff33);
}

button:hover { transform: scale(1.04); border-color: var(--accent2); }

/* GRID */
.grid {
  padding: 20px; display: grid; gap: 25px;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  width: clamp(260px, 95%, 1500px); margin: auto;
}

.card {
  background: var(--card); border-radius: var(--round);
  border: 1px solid var(--border); overflow: hidden;
  backdrop-filter: blur(var(--blur)); box-shadow: var(--card-shadow);
  transition: 0.3s ease; display: flex; flex-direction: column;
}

.card:hover { transform: translateY(-8px); border-color: var(--accent); }
.card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
.content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
.title { font-size: 1.1rem; font-weight: 700; margin-bottom: 6px; }
.meta { color: var(--muted); margin-bottom: 12px; font-size: 0.9rem; }

.card-actions { margin-top: auto; display: flex; gap: 10px; align-items: center; }
.card-link { color: var(--accent); text-decoration: none; font-weight: 600; font-size: 0.9rem; }
.copy-btn {
  background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border);
  color: var(--text); padding: 5px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem;
}

#toast {
  position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
  background: var(--accent); color: #000; padding: 12px 24px;
  border-radius: 30px; font-weight: 700; display: none; z-index: 2000;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

@media (max-width: 800px) {
  header h1 { font-size: 2.5rem; }
  .controls { width: 95%; flex-direction: column; }
  .grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
}
</style>
</head>
<body>

<div id="welcomeModal" class="modal-overlay">
  <div class="modal-content">
    <h2>Welcome to VortexAnime</h2>
    <p>Step into the vortex. Search globally for any anime, filter by your favorite genres, and share your finds with the world.</p>
    <button id="closeModal" style="width: 100%; padding: 15px; margin-top: 10px;">Enter the Vortex</button>
  </div>
</div>

<header>
  <h1>VortexAnime</h1>
  <p>Universal Discovery via AniList API</p>
</header>

<div class="controls">
  <input id="search" type="text" placeholder="Search title (e.g. Dragon Ball)..." />
  <select id="genre">
    <option value="">All Genres</option>
    <option value="Action">Action</option>
    <option value="Adventure">Adventure</option>
    <option value="Comedy">Comedy</option>
    <option value="Drama">Drama</option>
    <option value="Fantasy">Fantasy</option>
    <option value="Horror">Horror</option>
    <option value="Mecha">Mecha</option>
    <option value="Romance">Romance</option>
    <option value="Sci-Fi">Sci-Fi</option>
    <option value="Sports">Sports</option>
    <option value="Supernatural">Supernatural</option>
  </select>
  <select id="year"></select>
  <select id="season">
    <option value="">All Seasons</option>
    <option value="WINTER">Winter</option>
    <option value="SPRING">Spring</option>
    <option value="SUMMER">Summer</option>
    <option value="FALL">Autumn</option>
  </select>
  <button id="refresh">Refresh</button>
</div>

<div id="grid" class="grid"></div>
<button id="loadMore" style="display: none; margin: 40px auto; padding: 15px 45px;">Explore More</button>
<div id="toast">Link Copied!</div>

<script>
  const grid = document.getElementById("grid");
  const yearSel = document.getElementById("year");
  const seasonSel = document.getElementById("season");
  const genreSel = document.getElementById("genre");
  const searchInput = document.getElementById("search");
  const loadMoreBtn = document.getElementById("loadMore");
  const modal = document.getElementById("welcomeModal");
  const closeModal = document.getElementById("closeModal");
  const toast = document.getElementById("toast");

  let currentPage = 1;

  // Modal logic
  window.addEventListener('load', () => {
    if (!localStorage.getItem("vortex_v1_visited")) {
      modal.style.visibility = "visible";
      modal.style.opacity = "1";
    }
  });

  closeModal.onclick = () => {
    modal.style.opacity = "0";
    setTimeout(() => modal.style.visibility = "hidden", 400);
    localStorage.setItem("vortex_v1_visited", "true");
  };

  function setupYears() {
    const CURRENT_YEAR = new Date().getFullYear();
    let html = `<option value="">All Years</option>`;
    for (let y = CURRENT_YEAR + 1; y >= 1960; y--) {
      html += `<option value="${y}">${y}</option>`;
    }
    yearSel.innerHTML = html;
  }

  async function fetchAnime(isNewSearch = true) {
    if (isNewSearch) {
      currentPage = 1;
      grid.innerHTML = "<p style='grid-column: 1/-1; text-align: center; opacity: 0.6;'>Opening the Vortex...</p>";
    }

    const searchTerm = searchInput.value.trim();
    const variables = {
      page: currentPage,
      search: searchTerm || undefined,
      genre: genreSel.value || undefined,
      year: searchTerm ? undefined : (yearSel.value ? parseInt(yearSel.value) : undefined),
      season: searchTerm ? undefined : (seasonSel.value || undefined)
    };

    const query = `
      query ($page: Int, $year: Int, $season: MediaSeason, $search: String, $genre: String) {
        Page(page: $page, perPage: 24) {
          pageInfo { hasNextPage }
          media(seasonYear: $year, season: $season, search: $search, genre: $genre, type: ANIME, isAdult: false, sort: POPULARITY_DESC) {
            id
            title { english romaji }
            coverImage { extraLarge }
            seasonYear
            genres
            siteUrl
          }
        }
      }
    `;

    try {
      const response = await fetch('https://graphql.anilist.co', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query, variables })
      });
      const result = await response.json();
      const data = result.data.Page;
      if (isNewSearch) grid.innerHTML = "";
      renderCards(data.media);
      loadMoreBtn.style.display = data.pageInfo.hasNextPage ? "block" : "none";
    } catch (err) {
      grid.innerHTML = "<p style='grid-column: 1/-1; text-align: center;'>Connection failed. Try refreshing!</p>";
    }
  }

  function renderCards(list) {
    const html = list.map(anime => {
      const title = anime.title.english || anime.title.romaji;
      return `
        <div class="card">
          <img src="${anime.coverImage.extraLarge}" alt="cover" loading="lazy">
          <div class="content">
            <div class="title">${title}</div>
            <div class="meta">${anime.genres[0] || 'Anime'} • ${anime.seasonYear || ''}</div>
            <div class="card-actions">
              <a class="card-link" href="${anime.siteUrl}" target="_blank">Details</a>
              <button class="copy-btn" onclick="copyLink('${anime.siteUrl}')">Copy Link</button>
            </div>
          </div>
        </div>
      `;
    }).join('');
    grid.insertAdjacentHTML('beforeend', html);
  }

  window.copyLink = (url) => {
    navigator.clipboard.writeText(url).then(() => {
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 2000);
    });
  };

  setupYears();
  document.getElementById("refresh").onclick = () => fetchAnime(true);
  loadMoreBtn.onclick = () => { currentPage++; fetchAnime(false); };
  [yearSel, seasonSel, genreSel].forEach(el => el.onchange = () => fetchAnime(true));

  let timer;
  searchInput.oninput = () => {
    clearTimeout(timer);
    timer = setTimeout(() => fetchAnime(true), 600);
  };

  fetchAnime(true);
</script>
</body>
</html>
